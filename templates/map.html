{% extends 'base.html' %} {% block head %} {% endblock %} {% block body %}

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Google Map</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }

      .mapTitle {
        color: var(--deepblue);
        padding-top: 20px;
      }

      .search-bar {
        margin-top: 20px;
        text-align: center;
        padding-bottom: 20px;
      }

      #pac-input,
      #origin,
      #destination {
        width: 300px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
        margin-bottom: 10px;
      }

      #pac-input::placeholder,
      #origin::placeholder,
      #destination::placeholder {
        color: #808080;
      }

      #get-directions-btn {
        padding: 10px 20px;
        background-color: var(--deepblue);
        color: var(--lightgray);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }

      #get-directions-btn:hover {
        background-color: #176b87;
      }

      #map {
        height: 600px;
        width: 80%;
        margin: 0 auto;
        border: 5px solid var(--deepblue);
        border-radius: 10px;
        background-color: var(--lightgray);
      }

      .travel-info {
        text-align: center;
        margin-top: 20px;
        font-size: 18px;
        font-weight: bold;
      }

      .travel-mode {
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
      }

      .travel-mode i {
        margin-right: 5px;
        font-size: inherit;
      }
    </style>
  </head>
  <body>
    <div class="search-bar">
      <input id="pac-input" type="text" placeholder="Search" />
    </div>
    <div>
      <label for="origin">Origin:</label>
      <input type="text" id="origin" placeholder="Enter origin address" />
      <br />
      <label for="destination">Destination:</label>
      <input
        type="text"
        id="destination"
        placeholder="Enter destination address"
      />
      <br />
      <button id="get-directions-btn" onclick="calculateAndDisplayRoute()">
        Get Directions
      </button>
      <div class="travel-info" id="travel-info"></div>
      <div id="travel-time"></div>
      <div id="travel-distance"></div>
      <div id="walking-time"></div>
      <div id="bicycling-time"></div>
      <div id="transit-time"></div>
    </div>
    <div id="map"></div>
    <script>
      const defaultZoom = 4;
      let directionsService;
      let directionsRenderer;
      let distanceMatrixService;

      function initMap() {
        const location = { lat: -25.363, lng: 131.044 };
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: defaultZoom,
          center: location,
        });
        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer();
        distanceMatrixService = new google.maps.DistanceMatrixService();
        directionsRenderer.setMap(map);

        const markerIcon = {
          url: "https://maps.google.com/mapfiles/kml/shapes/parking_lot_maps.png",
          scaledSize: new google.maps.Size(40, 40),
        };
        const markerPosition = { lat: -33.8688, lng: 151.2195 };
        const marker = new google.maps.Marker({
          position: markerPosition,
          map: map,
          icon: markerIcon,
          title: "Custom Marker",
          draggable: true,
        });
        marker.addListener("click", function () {
          map.setCenter(marker.getPosition());
          map.setZoom(16);
        });
        marker.addListener("dragend", function (event) {
          console.log(
            "Marker dragged to:",
            event.latLng.lat(),
            event.latLng.lng()
          );
        });

        const input = document.getElementById("pac-input");
        const searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

        map.addListener("bounds_changed", function () {
          searchBox.setBounds(map.getBounds());
        });

        let markers = [];
        searchBox.addListener("places_changed", function () {
          const places = searchBox.getPlaces();
          if (places.length == 0) {
            return;
          }
          markers.forEach(function (marker) {
            marker.setMap(null);
          });
          markers = [];
          const bounds = new google.maps.LatLngBounds();
          places.forEach(function (place) {
            if (!place.geometry) {
              console.log("Returned place contains no geometry");
              return;
            }
            const icon = {
              url: place.icon,
              size: new google.maps.Size(71, 71),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(17, 34),
              scaledSize: new google.maps.Size(25, 25),
            };
            markers.push(
              new google.maps.Marker({
                map: map,
                icon: icon,
                title: place.name,
                position: place.geometry.location,
              })
            );
            if (place.geometry.viewport) {
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
          });
          map.fitBounds(bounds);
        });
      }

      function calculateAndDisplayRoute() {
        // retrieves the addresses entered by the user
        const origin = document.getElementById("origin").value;
        const destination = document.getElementById("destination").value;
        // checks if either the origin or destination code is missing and if it is, it asks the user to enter both addresses
        if (!origin || !destination) {
          alert("Please enter both origin and destination addresses.");
          return;
        }

        // iterates over every travel mode and obtains route information using Google Directions Service
        const travelModes = ["DRIVING", "WALKING", "BICYCLING", "TRANSIT"];
        travelModes.forEach(function (mode) {
          directionsService.route(
            {
              origin: origin,
              destination: destination,
              travelMode: mode,
            },
            function (response, status) {
              if (status === "OK") {
                //if the api returned a result successfully, it will then display the driving route on the map
                if (mode === "DRIVING") {
                  directionsRenderer.setDirections(response);
                }
                displayTravelTime(response, mode);
              } else {
                console.log("Directions request failed due to " + status);
              }
            }
          );
        });
      }

      function displayTravelTime(response, mode) {
        const duration = response.routes[0].legs[0].duration.text; //extracts the travel duration from the response object and accesses it in a readable way
        let elementId = "";
        switch (mode) {
          case "DRIVING":
            elementId = "travel-time"; // depending on the different modes it sets the elemntID as either biking, walking etc
            break;
          case "WALKING":
            elementId = "walking-time";
            break;
          case "BICYCLING":
            elementId = "bicycling-time";
            break;
          case "TRANSIT":
            elementId = "transit-time";
            break;
        }
        document.getElementById(
          elementId
        ).innerText = `Time to ${mode.toLowerCase()}: ${duration}`; //updates the inner text of the html element with the corresponding elementID, it includes the travel mode...
      }

      window.initMap = initMap;
    </script>

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC25kVhHoyX5OjED2X6jNkXCfLt8TcpEK0&libraries=places&callback=initMap"
    ></script>
  </body>
</html>
{% endblock %}
